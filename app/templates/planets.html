<!DOCTYPE html>
<html lang="en">

<head>

    <!-- App global header -->
    {% include 'head.html' %}

    <title>Star Wars - Planets</title>

</head>

<body>

    <!-- Page Content -->
    <div class="container">

        <!-- Page Heading -->
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">Planets</h1>
            </div>
        </div>
        <!-- /.row -->

        <!-- Sort Bar -->
        <div id = "sorts"> </div>

        <div class="row">
          <div class="col-lg-2 col-sm-2">
            <br>
            <h3>Residents</h3>
            <div class="checkbox">
             <label><input type="checkbox" value="">Luke Skywalker</label>
            </div>
            <div class="checkbox">
             <label><input type="checkbox" value="">R2-D2</label>
            </div>
            <div class="checkbox">
             <label><input type="checkbox" value="">Lobot</label>
            </div>

            <h3>Films</h3>
            <div class="checkbox">
             <label><input type="checkbox" value="">A New Hope</label>
            </div>
            <div class="checkbox">
             <label><input type="checkbox" value="">Return of the Jedi</label>
            </div>
            <div class="checkbox">
             <label><input type="checkbox" value="">The Empire Strikes Bac</label>
            </div>
          </div>
          <div class="col-lg-10 col-sm-10">
            <div id="grid_location"> </div>
          </div>
        </div>

        {#TODO: create common stylesheet for img style width and height#}
        <hr>

        <div class="row text-center">
          <ul class="pagination pagination-centered">
            <li><a href="#">1</a></li>
            <li><a href="#">2</a></li>
            <li><a href="#">3</a></li>
            <li><a href="#">4</a></li>
            <li><a href="#">5</a></li>
          </ul>
        </div>
        {% include 'footer.html' %}

    </div>
    <!-- /.container -->


    <script type="text/babel">

        var i;
        var x;
        var s;




        {% include 'table_builder.jsx' %}

        function buildModels(list, init)
        {
            var planets = [];
            for(i = 0; i < list.length; i++)
            {
                planets.push(<Planet planet={list[i]} />);
            }
            return planets
        }

        function load(error, response)
        {
            if(error == null)
            {
                console.log(response);
                document.getElementById("grid_location").innerHTML = "";
                renderTable(buildModels(response, true), document.getElementById("grid_location"), 3);
            }
        }

        var baseUrl = "/api/planets/";
        var filter = null;
        var filterBy = null;
        var sort = null;
        var up = 1;
        var page = 1;

        function buildURL()
        {
            var url = baseUrl;
            url += "?page="+page;
            if(filter != null)
                url += "&filterBy="+filterBy+"&filter"+filter;
            if(sort != null)
            {
                if(up)
                    url +="&sortUp="+sort;
                else
                    url +="&sortDown="+sort;
            }
            url += "&raw";
            return url;
        }

        function reload()
        {
            var url = buildURL();
            var req = new XMLHttpRequest();
            req.open('GET', url, true);
            req.responseType = 'json';
            req.onload = function() {
              var status = req.status;
              if (status == 200) {
                load(null, req.response);
              } else {
                load(status);
              }
            };
            req.send();
        }

        function sortBy(value)
        {
            sort = value;
            page = 1;
            reload();
        }

        function sortDir(value)
        {
            up = value;
            page = 1;
            reload();
        }

        function nextPage()
        {
            page += 1;
            reload();
        }

        function prevPage()
        {
            if(page != 1)
                page -= 1;
            reload();
        }

        function filterPage(filtBy, filt)
        {
            filterBy = filtBy;
            filter = filt;
            reload();
        }

        function Planet(props){
          return (
            <div className={"panel-container"}>
              <img className={"img-responsive grid-images"} src={props.planet.img_url} alt={""} />
              <a href={"planets/"+props.planet.id}><h2 className={"text-center"}>{props.planet.name}</h2></a>

              <ul className={"lists"}>
                  <li >Climate: {props.planet.climate}</li>
                  <li >Population: {props.planet.population}</li>
                  <li >Gravity: {props.planet.gravity}</li>
                  <li >Terrain: {props.planet.terrain}</li>
              </ul>
            </div>
        )}

        function PlanetSort(props){
            return (<div className={"row"}>
                      <div className={"col-lg-12"}>
                        <h4>Sort:
                            <a href={"#"} onClick={sortBy.bind(null, "name")}>Name </a>
                            <a href={"#"} onClick={sortBy.bind(null, "climate")}>Climate </a>
                            <a href={"#"} onClick={sortBy.bind(null, "population")}>Population </a>
                            <a href={"#"} onClick={sortBy.bind(null, "gravity")}>Gravity </a>
                            <a href={"#"} onClick={sortBy.bind(null, "terrain")}>Terrain </a>
                            <a><i className={"fa fa-chevron-down"} aria-hidden={"true"} onClick={sortDir.bind(null, 1)}></i></a>
                            <a><i className={"fa fa-chevron-up"} aria-hidden={"true"} onClick={sortDir.bind(null, 0)}></i></a>
                        </h4>
                        <hr />
                      </div>
                    </div>)
        }

        ReactDOM.render(<PlanetSort />, document.getElementById("sorts"));

        //var planet_list = JSON.parse({{planets | tojson}});

        //console.log(planet_list);
        reload();
        //renderTable(buildModels(planet_list, true), document.getElementById("grid_location"), 3);


    </script>

</body>

</html>
